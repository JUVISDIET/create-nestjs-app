#!/bin/sh

echo "Running pre-commit hook..."

# ì†ŒìŠ¤ì½”ë“œ íŒŒì¼ì´ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸
CHANGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx)$' | grep -v '\.d\.ts$')

if [ -z "$CHANGED_FILES" ]; then
    echo "âœ… No source code changes detected. Skipping lint..."
    exit 0
fi

# ì†ŒìŠ¤ì½”ë“œê°€ ë³€ê²½ëœ ê²½ìš°ì—ë§Œ lint ì‹¤í–‰
echo "ğŸ” Running lint on changed source files..."
pnpm run lint

# lint ëª…ë ¹ì˜ ì¢…ë£Œ ì½”ë“œ í™•ì¸
LINT_EXIT_CODE=$?

# lintê°€ ì‹¤íŒ¨í•˜ë©´ ì»¤ë°‹ ì¤‘ë‹¨
if [ $LINT_EXIT_CODE -ne 0 ]; then
    echo "âŒ Lint failed. Please fix the issues and try again."
    exit 1
fi

echo "âœ… All pre-commit checks passed. Proceeding with commit..."
exit 0