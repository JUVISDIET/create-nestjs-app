#!/bin/sh

echo "Running pre-commit hook..."

# 소스코드 파일이 변경되었는지 확인
CHANGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx)$' | grep -v '\.d\.ts$')

if [ -z "$CHANGED_FILES" ]; then
    echo "✅ No source code changes detected. Skipping lint..."
    exit 0
fi

# 소스코드가 변경된 경우에만 lint 실행
echo "🔍 Running lint on changed source files..."
pnpm run lint

# lint 명령의 종료 코드 확인
LINT_EXIT_CODE=$?

# lint가 실패하면 커밋 중단
if [ $LINT_EXIT_CODE -ne 0 ]; then
    echo "❌ Lint failed. Please fix the issues and try again."
    exit 1
fi

echo "✅ All pre-commit checks passed. Proceeding with commit..."
exit 0